---
import PageLayout from "../../layouts/PageLayout.astro";
import { experiments } from "../../data/experiments";
import { AstroError } from "astro/errors";

export async function getStaticPaths() {
  return experiments.map((exp) => ({
    params: { slug: exp.slug },
  }));
}

const { slug } = Astro.params;
const currentIndex = experiments.findIndex((e) => e.slug === slug);
const experiment = experiments[currentIndex];

if (!experiment) {
  throw new AstroError(`Experimento no encontrado: ${slug}`);
}

const prev = experiments[currentIndex - 1];
const next = experiments[currentIndex + 1];
---

<PageLayout
  title={experiment.title}
  description={experiment.description}
  path={[
    { href: "/", label: "Inicio" },
    { href: "/lab", label: "Lab" },
  ]}
  current={experiment.title}
>
  <div class="flex flex-wrap gap-3 justify-center pt-2">
    {
      experiment.tech.map((t) => (
        <span class="text-xs bg-primary/10 text-primary px-3 py-1 rounded-full font-medium tracking-wide">
          {t}
        </span>
      ))
    }
  </div>

  <div
    class="rounded-lg overflow-hidden border border-gray-300 dark:border-gray-700"
  >
    <iframe
      src={experiment.demo}
      title={`Demo ${experiment.title}`}
      class="w-full h-[400px] md:h-[500px] bg-white dark:bg-dark"></iframe>
  </div>

  {
    experiment.notes && experiment.notes.length > 0 && (
      <ul class="list-disc list-inside text-left text-dark dark:text-light/80 space-y-2">
        {experiment.notes.map((n) => (
          <li>{n}</li>
        ))}
      </ul>
    )
  }

  <div
    class="flex flex-wrap justify-between gap-4 pt-16 text-sm text-dark/60 dark:text-light/50"
  >
    {
      prev && (
        <a href={`/lab/${prev.slug}`} class="hover:text-primary transition">
          ← {prev.title}
        </a>
      )
    }
    <a href="/lab" class="mx-auto hover:text-primary transition">Ver todos</a>
    {
      next && (
        <a href={`/lab/${next.slug}`} class="hover:text-primary transition">
          {next.title} →
        </a>
      )
    }
  </div>
</PageLayout>

---
import Layout from "../../layouts/Layout.astro";
import NavbarBack from "../../components/NavbarBack.astro";
import { projects } from "../../data/projects";
import ProjectCard from "../../components/ProjectCard.astro";
import { AstroError } from "astro/errors";

export async function getStaticPaths() {
  return projects.map((p) => ({
    params: { slug: p.slug },
  }));
}

const { slug } = Astro.params;
const project = projects.find((p) => p.slug === slug);

if (!project) {
  throw new AstroError(`Proyecto no encontrado: ${slug}`);
}

const related = projects
  .filter((p) => p.slug !== project.slug)
  .sort(() => 0.5 - Math.random())
  .slice(0, 2);
---

<Layout>
  <NavbarBack
    path={[
      { href: "/", label: "Inicio" },
      { href: "/#projects", label: "Proyectos" },
    ]}
    current={project.title}
  />

  <section class="pt-28 px-6 md:px-12 max-w-5xl mx-auto space-y-16">
    <!-- Imagen principal -->
    <div
      data-reveal
      class="rounded-3xl overflow-hidden shadow-lg ring-1 ring-black/5 dark:ring-white/10"
    >
      <img
        src={project.image}
        alt={project.title}
        class="w-full object-cover max-h-[460px]"
      />
    </div>

    <!-- T√≠tulo y descripci√≥n -->
    <div data-reveal class="text-center space-y-6">
      <h1 class="text-4xl md:text-5xl font-extrabold text-dark dark:text-light">
        {project.title}
      </h1>
      <p class="text-dark/70 dark:text-light/60 text-base md:text-lg leading-relaxed">
        {project.description}
      </p>
    </div>

    <!-- Tecnolog√≠as -->
    <div data-reveal class="flex flex-wrap justify-center gap-3">
      {
        project.tech.map((tech) => (
          <span class="text-sm bg-primary/10 text-primary px-4 py-1.5 rounded-full font-medium tracking-wide dark:bg-accent/10 dark:text-accent">
            {tech}
          </span>
        ))
      }
    </div>

    <!-- Highlights -->
    {
      project.highlights && project.highlights.length > 0 && (
        <ul data-reveal class="list-disc list-inside text-left text-dark dark:text-light/80 space-y-2 max-w-xl mx-auto">
          {project.highlights.map((point) => (
            <li>{point}</li>
          ))}
        </ul>
      )
    }

    <!-- CTA -->
    <div data-reveal class="flex flex-col sm:flex-row justify-center gap-4 pt-6">
      {
        project.link && (
          <a
            href={project.link}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-full font-semibold shadow-md hover:shadow-lg transition bg-primary text-light hover:bg-accent dark:bg-accent dark:text-light dark:hover:bg-primary"
          >
            üåê Ver sitio en vivo
          </a>
        )
      }

      {
        project.repo && (
          <a
            href={project.repo}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-full font-semibold bg-dark text-white dark:bg-light dark:text-dark hover:bg-primary hover:text-white dark:hover:bg-primary dark:hover:text-white transition"
          >
            üõ†Ô∏è Ver repositorio
          </a>
        )
      }
    </div>

    <div data-reveal class="text-center pt-4">
      <a
        href="/#projects"
        class="text-sm text-dark/60 dark:text-light/50 underline hover:text-primary transition"
      >
        ‚Üê Volver a proyectos
      </a>
    </div>
  </section>

  <!-- Proyectos relacionados -->
  <section
    data-reveal
    class="mt-32 border-t pt-16 px-6 md:px-12 max-w-5xl mx-auto space-y-12"
  >
    <h2 class="text-2xl font-bold text-dark dark:text-light text-center">
      Tambi√©n te puede interesar
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {related.map((p) => <ProjectCard {...p} />)}
    </div>
  </section>
</Layout>

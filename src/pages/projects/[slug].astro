---
import Layout from "../../layouts/Layout.astro";
import NavbarBack from "../../components/NavbarBack.astro";
import { projects } from "../../data/projects";
import ProjectCard from "../../components/ProjectCard.astro";
import { AstroError } from "astro/errors";

export async function getStaticPaths() {
  return projects.map((p) => ({
    params: { slug: p.slug },
  }));
}

const { slug } = Astro.params;
const project = projects.find((p) => p.slug === slug);

if (!project) {
  throw new AstroError(`Proyecto no encontrado: ${slug}`);
}

const related = projects
  .filter((p) => p.slug !== project.slug)
  .sort(() => 0.5 - Math.random())
  .slice(0, 2);
---

<Layout>
  <NavbarBack
    path={[
      { href: "/", label: "Inicio" },
      { href: "/#projects", label: "Proyectos" },
    ]}
    current={project.title}
  />

  <section class="pt-28 px-6 md:px-12 max-w-5xl mx-auto space-y-16">
    <!-- Imagen principal -->
    <div
      data-reveal
      class="rounded-3xl overflow-hidden shadow-lg ring-1 ring-black/5 dark:ring-white/10"
    >
      <img
        src={project.image}
        alt={`Captura de ${project.title}`}
        class="w-full object-cover max-h-[460px]"
        loading="lazy"
      />
    </div>

    <!-- Contenido principal -->
    <div
      data-reveal
      class="bg-white/70 dark:bg-white/5 backdrop-blur-sm shadow-md rounded-2xl px-6 py-10 md:px-10 md:py-14 transition-all space-y-10"
    >
      <!-- T√≠tulo y descripci√≥n -->
      <div class="text-center space-y-6">
        <h1
          class="text-4xl md:text-5xl font-extrabold text-dark dark:text-white"
        >
          {project.title}
        </h1>
        <p
          class="text-neutral-700 dark:text-neutral-300 text-base md:text-lg leading-relaxed"
        >
          {project.description}
        </p>
      </div>

      <!-- Tecnolog√≠as -->
      {
        project.tech && project.tech.length > 0 && (
          <div class="flex flex-wrap justify-center gap-3">
            {project.tech.map((tech) => (
              <span class="text-sm bg-neutral-200 dark:bg-neutral-800 text-neutral-800 dark:text-neutral-200 px-4 py-1.5 rounded-full font-medium tracking-wide shadow-sm">
                {tech}
              </span>
            ))}
          </div>
        )
      }

      <!-- Highlights -->
      {
        project.highlights && project.highlights.length > 0 && (
          <ul class="list-disc list-inside text-left text-neutral-700 dark:text-neutral-300 space-y-2 max-w-xl mx-auto">
            {project.highlights.map((point) => (
              <li>{point}</li>
            ))}
          </ul>
        )
      }

      <!-- CTA -->
      <div class="flex flex-col sm:flex-row justify-center gap-4 pt-6">
        {
          project.link && (
            <a
              href={project.link}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-full font-semibold shadow-md hover:shadow-lg transition bg-primary text-white hover:bg-accent"
            >
              üåê Ver sitio en vivo
            </a>
          )
        }

        {
          project.repo && (
            <a
              href={project.repo}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-full font-semibold border-2 border-dark text-dark dark:border-light dark:text-light hover:bg-dark hover:text-white dark:hover:bg-light dark:hover:text-dark transition"
            >
              üõ†Ô∏è Ver repositorio
            </a>
          )
        }
      </div>

      <div class="text-center pt-4">
        <a
          href="/#projects"
          class="text-sm text-neutral-500 dark:text-neutral-400 underline hover:text-primary transition"
        >
          ‚Üê Volver a proyectos
        </a>
      </div>
    </div>
  </section>

  <!-- Proyectos relacionados -->
  <section
    data-reveal
    class="mt-32 border-t border-neutral-200 dark:border-neutral-700 pt-16 px-6 md:px-12 max-w-5xl mx-auto space-y-12"
  >
    <h2 class="text-2xl font-bold text-dark dark:text-white text-center">
      Tambi√©n te puede interesar
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {related.map((p) => <ProjectCard {...p} />)}
    </div>
  </section>
</Layout>

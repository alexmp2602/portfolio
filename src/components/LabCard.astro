---
interface Props {
  title: string;
  slug?: string;
  description?: string;
  image?: string;
  imageWebp?: string;
  imageAvif?: string;
  href?: string;
  demo?: string;
}

const {
  title,
  slug = "",
  description,
  image,
  imageWebp,
  imageAvif,
  href,
} = Astro.props as Props;

const fallback = "/assets/lab/default.webp";
const poster = image && image.trim() !== "" ? image : fallback;

const makeId = (s: string) =>
  s
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/(^-|-$)/g, "");
const titleId = `lab-${slug || makeId(title)}`;

const url = href ?? (slug ? `/lab/${slug}` : "#");
const isExternal = !!href && /^https?:\/\//i.test(href);
---

<a
  href={url}
  class="group block glass-card rounded-2xl overflow-hidden transition-transform duration-300 hover:scale-[1.02] motion-reduce:hover:scale-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2"
  aria-labelledby={titleId}
  data-reveal
  target={isExternal ? "_blank" : undefined}
  rel={isExternal ? "noopener noreferrer" : undefined}
>
  <figure class="w-full">
    <picture>
      {imageAvif && <source srcset={imageAvif} type="image/avif" />}
      {imageWebp && <source srcset={imageWebp} type="image/webp" />}
      <img
        src={poster}
        alt={`Vista de ${title}`}
        loading="lazy"
        decoding="async"
        width="640"
        height="270"
        class="w-full h-48 md:h-56 object-cover border-t border-black/5 dark:border-white/10 group-hover:opacity-90 transition-opacity duration-300"
      />
    </picture>
    <figcaption class="sr-only">{title}</figcaption>
  </figure>

  <div
    class="p-6 surface-muted backdrop-blur-sm transition-colors duration-300"
  >
    <h3
      id={titleId}
      class="text-lg md:text-xl font-bold text-surface group-hover:text-primary dark:group-hover:text-accent transition-colors"
    >
      {title}
    </h3>

    {
      description && (
        <p class="mt-3 text-surface-muted leading-relaxed">{description}</p>
      )
    }
  </div>
</a>

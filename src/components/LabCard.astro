---
const { title, slug, demo, image } = Astro.props;
const hasIframe = !!demo;
const demoId = `lab-${slug}`;
---

<article
  class="glass-card rounded-2xl overflow-hidden shadow-subtle transition-transform duration-300 hover:scale-[1.02] group h-full flex flex-col"
  role="article"
  aria-labelledby={demoId}
  data-reveal
>
  <a
    href={`/lab/${slug}`}
    class="flex flex-col justify-between h-full"
    aria-label={`Ver demo: ${title}`}
  >
    <div class="p-6">
      <h3
        id={demoId}
        class="text-lg md:text-xl font-bold text-surface group-hover:text-primary dark:group-hover:text-accent transition-colors"
      >
        {title}
      </h3>
    </div>

    {
      hasIframe ? (
        <iframe
          src={demo}
          title={`Vista previa animada de ${title}`}
          loading="lazy"
          sandbox="allow-scripts allow-same-origin allow-popups"
          class="w-full h-48 border-t border-black/5 dark:border-white/10 transition duration-300 md:pointer-events-auto md:opacity-100 pointer-events-none opacity-70 grayscale-[30%] rounded-b-2xl"
        />
      ) : (
        <img
          src={image ?? "/assets/lab/default.webp"}
          alt={`Vista previa de ${title}`}
          loading="lazy"
          decoding="async"
          width="640"
          height="270"
          class="w-full h-48 object-cover border-t border-black/5 dark:border-white/10 group-hover:opacity-90 transition-opacity duration-300 rounded-b-2xl"
        />
      )
    }
  </a>
</article>

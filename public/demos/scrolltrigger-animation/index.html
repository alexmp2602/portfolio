<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ScrollTrigger Animado</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <style>
      :root {
        --fg: #fafafa;
        --bg: #1f1f1f;
        --a: #256340;
        --b: #60a98f;
        --c: #eaeaea;
      }
      * {
        box-sizing: border-box;
        margin: 0;
      }
      body {
        font-family: ui-sans-serif, system-ui, sans-serif;
        background: var(--bg);
        color: var(--fg);
        line-height: 1.5;
      }

      section {
        min-height: 100svh;
        display: grid;
        place-items: center;
        padding: 4rem 2rem;
        text-align: center;
      }
      .one {
        background: var(--a);
      }
      .two {
        background: var(--b);
        color: #111;
      }
      .three {
        background: var(--c);
        color: #111;
      }

      .wrap {
        max-width: 900px;
        display: grid;
        gap: 16px;
      }
      h2 {
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 900;
        letter-spacing: 0.01em;
      }
      p {
        font-size: clamp(1rem, 2.5vw, 1.125rem);
        opacity: 0.85;
      }

      /* Estado inicial para reveal */
      [data-st-reveal] {
        opacity: 0;
        transform: translateY(24px);
      }

      /* Reduce motion → contenido visible y sin animaciones */
      @media (prefers-reduced-motion: reduce) {
        [data-st-reveal] {
          opacity: 1 !important;
          transform: none !important;
        }
      }

      /* Parallax capa opcional */
      .parallax-bg {
        position: absolute;
        inset: -10% 0 -10% 0;
        z-index: -1;
        background-size: cover;
        background-position: center;
        filter: contrast(1.05) brightness(0.9);
        will-change: transform; /* se activa solo si visible */
      }
      .two {
        position: relative;
        overflow: hidden;
      }
      .two .parallax-bg {
        background-image: url("https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1600&q=80");
      }
    </style>
  </head>
  <body>
    <section class="one">
      <div class="wrap">
        <h2 data-st-reveal>ScrollTrigger Animado</h2>
        <p data-st-reveal>
          Secciones que aparecen suavemente al entrar en pantalla.
        </p>
      </div>
    </section>

    <section class="two" data-parallax>
      <div class="parallax-bg"></div>
      <div class="wrap">
        <h2 data-st-reveal>Parallax sutil + Reveal</h2>
        <p data-st-reveal>
          El fondo se desplaza con scrub y los textos revelan con stagger.
        </p>
      </div>
    </section>

    <section class="three">
      <div class="wrap">
        <h3 data-st-reveal>Listo para implementarlo en cualquier proyecto</h3>
        <p data-st-reveal>Accesible, performante y fácil de mantener.</p>
      </div>
    </section>

    <script>
      // Registro plugin
      gsap.registerPlugin(ScrollTrigger);

      // Respeto reduce-motion
      const reduce = matchMedia("(prefers-reduced-motion: reduce)").matches;

      if (!reduce) {
        // Estado inicial con GSAP (evita repaint doble del CSS)
        gsap.set("[data-st-reveal]", {
          opacity: 0,
          y: 24,
          willChange: "transform,opacity",
        });

        // Batch reveal: menos ScrollTriggers, stagger automático
        ScrollTrigger.batch("[data-st-reveal]", {
          start: "top 85%",
          once: true,
          onEnter: (batch) => {
            gsap.to(batch, {
              opacity: 1,
              y: 0,
              duration: 0.7,
              ease: "power2.out",
              stagger: { each: 0.1 },
            });
            // limpiar will-change luego de animar
            batch.forEach((el) =>
              el.addEventListener(
                "transitionend",
                () => (el.style.willChange = "")
              )
            );
          },
        });

        // Parallax sutil por sección
        document.querySelectorAll("[data-parallax]").forEach((sec) => {
          const bg = sec.querySelector(".parallax-bg");
          if (!bg) return;

          // activar will-change solo cuando está visible
          ScrollTrigger.create({
            trigger: sec,
            start: "top bottom",
            end: "bottom top",
            onEnter: () => (bg.style.willChange = "transform"),
            onLeave: () => (bg.style.willChange = ""),
            onEnterBack: () => (bg.style.willChange = "transform"),
            onLeaveBack: () => (bg.style.willChange = ""),
          });

          gsap.to(bg, {
            yPercent: -15, // movimiento sutil
            ease: "none",
            scrollTrigger: {
              trigger: sec,
              start: "top bottom",
              end: "bottom top",
              scrub: 0.5,
            },
          });
        });

        // Refresh por si hay fuentes/imagenes que cambian layout
        window.addEventListener("load", () => ScrollTrigger.refresh());
      } else {
        // Sin animación: mostrar todo
        document.querySelectorAll("[data-st-reveal]").forEach((el) => {
          el.style.opacity = 1;
          el.style.transform = "none";
        });
      }
    </script>
  </body>
</html>

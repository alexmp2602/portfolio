<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cursor Personalizado • GSAP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <style>
      :root {
        --bg: #111315;
        --fg: #f6f7f9;
        --muted: #cfd3d8;
        --ring: rgba(255, 255, 255, 0.42);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        margin: 0;
      }

      body {
        background: radial-gradient(
          1200px 800px at 70% -10%,
          #1c2023 0%,
          var(--bg) 55%
        );
        color: var(--fg);
        font:
          16px/1.45 ui-sans-serif,
          system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          Arial;
      }

      main {
        min-height: 100%;
        display: grid;
        place-items: center;
        text-align: center;
        padding: 28px;
      }

      h1 {
        margin: 0 0 10px;
        font-size: clamp(28px, 5vw, 48px);
        letter-spacing: 0.02em;
      }

      p {
        margin: 0;
        color: var(--muted);
      }

      /* Cursor custom (solo cuando está habilitado) */
      html.custom-cursor body {
        cursor: none;
      }

      .cursor-dot,
      .cursor-ring {
        position: fixed;
        left: 0;
        top: 0;
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 9999;
        opacity: 0; /* arranca oculto hasta el primer movimiento */
      }

      .cursor-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: #fff;
        mix-blend-mode: difference;
      }

      .cursor-ring {
        width: 36px;
        height: 36px;
        border-radius: 999px;
        border: 1px solid var(--ring);
        background: radial-gradient(
          20px 20px at 50% 50%,
          rgba(255, 255, 255, 0.15),
          transparent 60%
        );
        filter: drop-shadow(0 2px 10px rgba(0, 0, 0, 0.4));
      }

      /* Accesibilidad: permitir selección de texto cuando el cursor custom está desactivado */
      .no-custom-cursor * {
        user-select: text;
      }

      /* Touch / reduce-motion: sin cursor custom */
      .no-custom-cursor .cursor-dot,
      .no-custom-cursor .cursor-ring {
        display: none;
      }

      /* Focus visible básico */
      :focus-visible {
        outline: 2px solid rgba(255, 255, 255, 0.7);
        outline-offset: 3px;
      }
    </style>
  </head>

  <body>
    <main>
      <div>
        <h1>Cursor personalizado con GSAP</h1>
        <p>Micro-lag y pulso al click. Mové el mouse.</p>
      </div>
    </main>

    <div class="cursor-dot" aria-hidden="true"></div>
    <div class="cursor-ring" aria-hidden="true"></div>

    <script>
      (function () {
        const isTouch =
          "ontouchstart" in window || navigator.maxTouchPoints > 0;
        const reduce = window.matchMedia(
          "(prefers-reduced-motion: reduce)",
        ).matches;

        if (isTouch || reduce) {
          document.documentElement.classList.add("no-custom-cursor");
          return;
        }

        document.documentElement.classList.add("custom-cursor");

        const dot = document.querySelector(".cursor-dot");
        const ring = document.querySelector(".cursor-ring");
        if (!dot || !ring || !window.gsap) return;

        // Estado inicial (evita “salto” al cargar)
        let x = innerWidth / 2;
        let y = innerHeight / 2;
        gsap.set([dot, ring], { x, y, opacity: 0 });

        const qDotX = gsap.quickTo(dot, "x", {
          duration: 0.12,
          ease: "power3",
        });
        const qDotY = gsap.quickTo(dot, "y", {
          duration: 0.12,
          ease: "power3",
        });
        const qRingX = gsap.quickTo(ring, "x", {
          duration: 0.35,
          ease: "power2",
        });
        const qRingY = gsap.quickTo(ring, "y", {
          duration: 0.35,
          ease: "power2",
        });
        const qDotO = gsap.quickTo(dot, "opacity", {
          duration: 0.2,
          ease: "power2",
        });
        const qRingO = gsap.quickTo(ring, "opacity", {
          duration: 0.25,
          ease: "power2",
        });

        const move = (e) => {
          x = e.clientX;
          y = e.clientY;
          qDotX(x);
          qDotY(y);
          qRingX(x);
          qRingY(y);
          qDotO(1);
          qRingO(0.7);
        };

        addEventListener("mousemove", move, { passive: true });

        // Oculta/mostrar al salir/entrar de la ventana
        addEventListener(
          "mouseleave",
          () => {
            qDotO(0);
            qRingO(0);
          },
          { passive: true },
        );

        addEventListener(
          "mouseenter",
          () => {
            qDotO(1);
            qRingO(0.7);
          },
          { passive: true },
        );

        // Pulso al click (sin generar basura si spamean clicks)
        let pulseTween;
        addEventListener("pointerdown", () => {
          if (pulseTween) pulseTween.kill();

          pulseTween = gsap
            .timeline()
            .to(
              ring,
              { scale: 0.95, opacity: 0.5, duration: 0.18, ease: "power2.out" },
              0,
            )
            .fromTo(
              dot,
              { scale: 0.85 },
              { scale: 1, duration: 0.18, ease: "power2.out" },
              0,
            )
            .to(
              ring,
              { scale: 1, opacity: 0.7, duration: 0.22, ease: "power2.out" },
              0.18,
            );

          const pulse = document.createElement("div");
          pulse.setAttribute("aria-hidden", "true");
          pulse.style.cssText =
            "position:fixed;left:0;top:0;transform:translate(-50%,-50%);width:10px;height:10px;border-radius:999px;pointer-events:none;z-index:9998;border:1px solid rgba(255,255,255,.35)";
          document.body.appendChild(pulse);

          gsap.set(pulse, { x, y });
          gsap.to(pulse, {
            width: 80,
            height: 80,
            opacity: 0,
            duration: 0.5,
            ease: "power1.out",
            onComplete: () => pulse.remove(),
          });
        });
      })();
    </script>
  </body>
</html>
